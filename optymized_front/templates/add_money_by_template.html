<!DOCTYPE html>
<html>
<head>
    <title>–ó–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ —à–∞–±–ª–æ–Ω—É</title>
    <style>
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
        input, select {
            padding: 8px;
            width: 200px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .card-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .distribution-preview {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>üí≥ –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ —à–∞–±–ª–æ–Ω—É</h1>
    
    <div class="card-info">
        <h3>–ö–∞—Ä—Ç–∞: {{ card }}</h3>
        <p>–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: {{ card.amount }} —Ä—É–±.</p>
    </div>

    <form method="POST">
        <div class="form-group">
            <label for="total_amount">–°—É–º–º–∞ –¥–ª—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è:</label>
            <input type="number" id="total_amount" name="total_amount" min="1" required 
                   onchange="updateDistributionPreview()">
        </div>
        
        <div class="form-group">
            <label for="template_id">–®–∞–±–ª–æ–Ω —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:</label>
            <select id="template_id" name="template_id" required onchange="updateDistributionPreview()">
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω --</option>
                {% for template in templates %}
                <option value="{{ template.template_id }}" data-percents="{{ template.percents }}">
                    {% for k, v in data-percents.items() %}
                        {{ category_by_id(k).category_name }}: {{ v }}
                    {% endfor %}
                </option>
                {% endfor %}
            </select>
        </div>

        <div id="distribution-preview" class="distribution-preview">
            <h4>–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:</h4>
            <div id="preview-content"></div>
        </div>

        <button type="submit">–ó–∞—á–∏—Å–ª–∏—Ç—å –¥–µ–Ω—å–≥–∏</button>
    </form>

    <script>
        function updateDistributionPreview() {
            const amount = parseInt(document.getElementById('total_amount').value);
            const templateSelect = document.getElementById('template_id');
            const selectedOption = templateSelect.options[templateSelect.selectedIndex];
            const previewDiv = document.getElementById('distribution-preview');
            const previewContent = document.getElementById('preview-content');
            
            if (amount && amount > 0 && selectedOption.value) {
                const percents = JSON.parse(selectedOption.getAttribute('data-percents'));
                let html = '<ul>';
                
                for (const [categoryId, percent] of Object.entries(percents)) {
                    const categoryAmount = Math.floor(amount * percent / 100);
                    html += `<li>–ö–∞—Ç–µ–≥–æ—Ä–∏—è ${categoryId}: ${categoryAmount} —Ä—É–±. (${percent}%)</li>`;
                }
                
                html += '</ul>';
                previewContent.innerHTML = html;
                previewDiv.style.display = 'block';
            } else {
                previewDiv.style.display = 'none';
            }
        }
    </script>
</body>
</html>